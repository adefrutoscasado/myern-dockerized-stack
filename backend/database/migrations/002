// Example migration. Add the '.js' extension to activate it
// Our 0.0.2 version includes the tables 'ingredient' and 'recipe_ingredient

exports.up = async function (knex) {
  await knex.raw(`
    # Use singular names for tablenames
    CREATE TABLE ingredient (
      id MEDIUMINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      # VARCHAR(255) and VARCHAR(2) take exactly the same amount of space on disk
      name VARCHAR(255) NOT NULL UNIQUE
    );
    
    # Has-many relation
    CREATE TABLE recipe_ingredient(
      id MEDIUMINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      ingredient_id INT NOT NULL,
      pet_id INT NOT NULL,
      FOREIGN KEY (recipe_id) REFERENCES recipe(id),
      FOREIGN KEY (ingredient_id) REFERENCES ingredient(id),
      UNIQUE (ingredient_id, pet_id)
    );
  `)
}

exports.down = async function (knex) {
  await knex.raw(`
    DROP TABLE recipe_ingredient;
    DROP TABLE ingredient;
  `)
}

exports.config = { transaction: true }